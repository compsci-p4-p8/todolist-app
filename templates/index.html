<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Todo List</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>

    <!-- Animated background bubbles -->
    <div class="bg-anim">
      <div class="bubble" style="width: 120px; height: 120px; left: 10vw; animation-delay: 0s; background: #4f8cff;"></div>
      <div class="bubble" style="width: 80px; height: 80px; left: 70vw; animation-delay: 2s; background: #6fd6ff;"></div>
      <div class="bubble" style="width: 100px; height: 100px; left: 40vw; animation-delay: 4s; background: #a1c4fd;"></div>
      <div class="bubble" style="width: 60px; height: 60px; left: 85vw; animation-delay: 6s; background: #c2e9fb;"></div>
      <div class="bubble" style="width: 90px; height: 90px; left: 25vw; animation-delay: 8s; background: #4f8cff;"></div>
    </div>

    <div class="container">
      <h1>Todo List</h1>
      <p>Logged in as: <strong>{{ user['username'] }}</strong></p>
      <form method="post" action="{{ url_for('logout') }}">
        <button type="submit">Logout</button>
      </form>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul>
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('add') }}">
        <input type="text" name="title" placeholder="New todo" required />
        <button type="submit">Add</button>
      </form>

      {% if todos %}
        <ul>
          {% for t in todos %}
            <li>
              <form style="display:inline" method="post" action="{{ url_for('toggle', todo_id=t['id']) }}">
                <input type="checkbox" onchange="this.form.submit()" {% if t['completed'] %}checked{% endif %} />
              </form>
              <span {% if t['completed'] %}style="text-decoration: line-through; color: #666;"{% endif %}>{{ t['title'] }}</span>
              <form style="display:inline" method="post" action="{{ url_for('delete', todo_id=t['id']) }}">
                <button type="submit">Delete</button>
              </form>
            </li>
          {% endfor %}
        </ul>
        <form method="post" action="{{ url_for('clear_completed') }}">
          <button type="submit">Clear completed</button>
        </form>
      {% else %}
        <p>No todos yet.</p>
      {% endif %}
    </div>
  </body>
  </html>
